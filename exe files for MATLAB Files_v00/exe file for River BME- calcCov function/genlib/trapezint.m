function [I]=trapezint(x,y,xmin,xmax);% trapezint                 - integration using trapezoidal formula (Jan 1,2001)%% Compute the integral of a discretized definition of a function of% a single variable using a trapezoidal integration formula.%% SYNTAX :%% [I]=trapezint(x,y,xmin,xmax);%% INPUT :%% x      n by 1   vector of values for the variable.% y      n by 1   vector for the values of the function at the x values.% xmin   scalar   lower bound for the integration.% xmax   scalar   upper bound for the integration.%% OUTPUT :%% I      scalar   integral of the function y=f(x) between xmin and xmax.%% NOTE :%% Not-a-Number (NaN) values for x and y are automatically stripped out% when computing the integral. As the functions is using the interp1.m% MATLAB function, trapezint.m requires x be monotonic.[x,index]=sort(x);y=y(index);index=find((~isnan(x))&(~isnan(y)));x=x(index);y=y(index);n=length(x);if xmin>x(1),  ymin=interp1(x,y,xmin,'linear');  cond=(x>xmin);  x=x(cond);  y=y(cond);  x=[xmin;x];  y=[ymin;y];end;n=length(x);if xmax<x(n),  ymax=interp1(x,y,xmax,'linear');  cond=(x<xmax);  x=x(cond);  y=y(cond);  x=[x;xmax];  y=[y;ymax];end;n=length(x);y=0.5*y(1:n-1)+0.5*y(2:n);I=sum(y.*diff(x));